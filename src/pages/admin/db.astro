---
import Layout from "@/layouts/Layout.astro";

import { House, Stethoscope, Pill, Link } from "@lucide/astro";

import Sintomas from "@/components/Sintomas.astro";
import Medicamentos from "@/components/Medicamentos.astro";
import Relaciones from "@/components/Relaciones.astro";

import { getPaginationData, PAGE_SIZE } from "@/utils/pagination.ts";

const url = new URL(Astro.request.url);

const {
    medPage,
    sintPage,
    relPage,
    medTotal,
    sintTotal,
    relTotal,
    medicamentos,
    sintomas,
    relaciones
} = await getPaginationData(url);
---

<Layout title="Base de Datos" descripcion="Administra síntomas, medicamentos y relaciones">
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { background-color: white; color: black; border: 1px solid gray; }
        .tab-button { color: gray; }
        .tab-button:hover { background-color: white; color: black; cursor: pointer; border: 1px solid gray; }
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 0.375rem;
            background-color: #f3f4f6;
            color: #374151;
        }
        .badge-alta { background-color: #fef2f2; color: #dc2626; }
        .badge-media { background-color: #fef3c7; color: #d97706; }
        .badge-baja { background-color: #f0fdf4; color: #16a34a; }
    </style>

    <div class="max-w-6xl mx-auto p-4">
        <!-- Cabezera -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">Gestión de base de datos de Capsulin</h1>
            <p class="text-gray-600">Administra síntomas, medicamentos y sus relaciones</p>
        </div>

        <!-- Navegación -->
        <div class="flex flex-row justify-center mb-8">
            <div class="bg-gray-100 rounded-lg p-1 border border-gray-300 shadow-2xs flex flex-row gap-2 flex-wrap sm:flex-nowrap w-full max-w-2xl">
                <a href="/" class="tab-button px-4 sm:px-8 py-1 rounded-md font-medium text-sm transition-colors flex items-center flex-1 justify-center">
                    <House class="w-4 h-4 inline mr-2" />
                    Inicio
                </a>
                <button id="tab-sintomas" class="tab-button px-4 sm:px-8 py-1 rounded-md font-medium text-sm transition-colors active flex items-center flex-1 justify-center">
                    <Stethoscope class="w-4 h-4 inline mr-2" />
                    Síntomas
                </button>
                <button id="tab-medicamentos" class="tab-button px-4 sm:px-8 py-1 rounded-md font-medium text-sm transition-colors flex items-center flex-1 justify-center">
                    <Pill class="w-4 h-4 inline mr-2" />
                    Medicamentos
                </button>
                <button id="tab-relaciones" class="tab-button px-4 sm:px-8 py-1 rounded-md font-medium text-sm transition-colors flex items-center flex-1 justify-center">
                    <Link class="w-4 h-4 inline mr-2" />
                    Relaciones
                </button>
            </div>
        </div>

        <!-- Síntomas Tab -->
        <div id="sintomas-content" class="tab-content active">
            <Sintomas 
            sintomas={sintomas} sintPage={sintPage} sintTotal={sintTotal}
            medPage={medPage}
            relPage={relPage}
            PAGE_SIZE={PAGE_SIZE}
            />
        </div>

        <!-- Medicamentos Tab -->
        <div id="medicamentos-content" class="tab-content">
            <Medicamentos 
            intPage={sintPage}
            medicamentos={medicamentos} medPage={medPage} medTotal={medTotal}
            relPage={relPage}
            PAGE_SIZE={PAGE_SIZE}
            />
        </div>

        <!-- Relaciones Tab -->
        <div id="relaciones-content" class="tab-content">
            <Relaciones
            sintPage={sintPage}
            medPage={medPage}
            relaciones={relaciones} relPage={relPage} relTotal={relTotal}
            PAGE_SIZE={PAGE_SIZE}
            />
        </div>
    </div>

    <script type="module" src="/assets/js/showTab.js"></script>
    <script type="module" src="/assets/js/searchField.js"></script>
</Layout>